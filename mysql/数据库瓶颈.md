为什么要分库分表？为了解决数据库瓶颈，数据库的瓶颈主要来自：IO 瓶颈 与 CPU 瓶颈  
### 什么时候需要分库分表？  
单表行数超过500w行，或者单表容量超过2G。如果预计三年后的数据量根本达不到这个级别，就不要在创建表时就分库分表。——阿里巴巴手册
### IO瓶颈  
1. 磁盘读 IO 瓶颈，热点数据太多，数据库缓存放不下，每次查询时会产生大量的 IO，降低查询速度。（分库和垂直分表）
2. 网络 IO 瓶颈，请求的数据太多，网络带宽不够。（分库）  

### CPU 瓶颈  
1. SQL 问题，如 SQL 中包含 join，group by，order by，非索引字段条件查询等，增加 CPU 运算的操作 
       （SQL优化，建立合适的索引，在业务Service层进行业务计算）。   
2. 单表数据量太大，查询时扫描的行太多，SQL效率低，CPU率先出现瓶颈 （水平分表）。  

### 水平分库分表  
* 水平分库： user_id -> user_id%2=0(`db user 0`)、user_id%2=1(`db user 1`), order_id -> ...  
* 水平分表： user_id -> user_id%2=0(`tb user_0 ` user_id=0、2、4...)、user_id%2=1(`tb user_1` user_id=1、3、5...)。   

### 垂直分表  
* 按列进行拆分，比如将用户表细分为账户表、基本信息表等。拆分后的每个表的字段至少有一列交集，一般是主键，用于关联数据。  
* 场景：数据库的并发量不是很高，表记录不多但却字段多，热点数据和非热点数据在一起，单行数据所需的存储空间较大，
导致数据库缓存的数据行减少，查询时会去读磁盘数据产生大量的随机读IO，产生IO瓶颈。  
* 原则：垂直分表的拆分原则是将热点数据（可能会冗余经常一起查询的数据）放在一起作为主表，非热点数据放在一起作为扩展表。（例如列表页和详情页），
这样更多的热点数据就能被缓存下来，进而减少了随机读IO。  
* 注意：拆了之后，要想获得全部数据就需要关联两个表来取数据的时候`千万别用join`，因为join不仅会增加CPU负担并且会将两个表耦合在一起
（在一个数据库实例上）。关联数据应该在业务Service层做处理，分别获取主表和扩展表数据然后用关联字段关联得到全部数据。 

### 分库分表工具对比  
todo...
