### 内存溢出原因
平时遇到的内存溢出问题一般分为两种：
* 一种是由于大峰值下没有限流，瞬间创建大量对象而导致的内存溢出；
* 另一种则是由于内存泄漏而导致的内存溢出。  

使用限流，一般就可以解决第一种内存溢出问题，但其实很多时候，内存溢出往往是内存泄漏导致的，这种问题就是程序的 BUG，需要及时找到问题代码。

### 排查  



1. 在启动应用程序之前，可以通过 `HeapDumpOnOutOfMemoryError 和 HeapDumpPath` 这两个参数开启堆内存异常日志。  

2. 根据开启的日志可以判断是否有内存溢出异常。首先通过 Linux `top` 命令查看 java 进程在整个系统中内存的使用率是多少。  

3. 如果 Java 进程内存使用率过高，可再通过 `top -Hp pid` 查看具体线程占用系统资源情况。  

4. 再通过 `jstack pid` 查看具体线程的堆栈信息，查看线程是否有死锁，此时 CPU 使用率和负载如果没有出现异常，那么就可以排除死锁或 I/O 阻塞的异常问题了。

5. 再通过 `jmap -heap pid` 查看堆内存的使用情况，查看内存使用率是否有过高情况，比如：老年代的使用率几乎快占满了，而且内存一直得不到释放。  

6. 如果堆内存使用率异常，可以判断系统发生了内存泄漏。下面就需要找到具体是什么对象一直无法回收，什么原因导致了内存泄漏， 通过 `jstat` 查看存活对象的数量。

7. 通过 `jstat` 会发现某个类型对象（比如 java.lang.Byte）存活数量异常高， 说明代码中 Byte 对象存在内存泄漏，由于在开始的第一步已经设置了 dump 日志文件，通过 `MAT（编辑器插件）` 打开 dump 的内存日志文件，我们可以发现 MAT 以查看到具体哪个对象引用了这个对象。

8. 通过查看代码中的的对象，明显地查看到是那块代码出现了问题。也可以将这段代码注释为空代码，再次进行二次验证，进而准确定位问题所在。
