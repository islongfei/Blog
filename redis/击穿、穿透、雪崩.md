### 缓存击穿  
缓存击穿:请求一个数据，缓存没有，数据库有。  

**解决方案**：
* **互斥锁**：如果发现redis没有对应的数据，让多个线程竞争锁，抢到锁的一个去构建数据，其他线程睡眠
睡眠100ms,再次查询redis.缺点让用户多等待了宝贵的100ms.

* **后台预更新**：后台开一个定时任务，专门主动更新即将过期的数据，比如热点key设置过期时间为60min
，那么在第55min时，去查询数据库重新放入缓存中，再次设置缓存为60min，
还可以做缓存预热(项目启动前，先加载缓存)操作。

* **永不过期**：如果根据实际场景可以判断出这个key就是一个热点key，那么就直接放进去，永不过期，
大道至简。


### 缓存穿透    

缓存穿透：访问的数据缓存和数据库都没有，一般来说这种属于恶意请求。    

**解决方案** 

* **缓存空对象**：如果缓存和数据库都没数据，就写一个空值到缓存里去，
那么就缓存一个孔下次同样请求就会命中这个空对象，缓存层就处理了这个请求，不会对数据库产生压力。
如果在某个时间，缓存为空的记录，在数据库里面有值了
那么设置过期时间，如何实时性要求高在写数据库的时候还可以写缓存，保证实时性，
如果实时性不高就可以用消息队列异步去取。

如果恶意攻击，请求的时候往往key各不相同，那么还是会大量请求到数据库。
这时就需要引用布隆过滤器来处理。

* **[布隆过滤器](https://mp.weixin.qq.com/s/iL9lvG1Zdd0srl6nUtYq4Q)**：
 当布隆过滤器说某个值存在时，这个值可能不存在;当它说不存在时，那就肯定不存在。
所以布隆过滤器返回的结果是概率性的，所以它能缓解数据库的压力，并不能完全挡住
要在分布式环境下使用布隆过滤器，那还得redis出马，redis可以用来实现布隆过滤器。

### 缓存雪崩：  

缓存雪崩是指缓存中大多数的数据在同一时间到达过期时间，而查询数据量巨大，
引起数据库流量激增，压力瞬间增大。

**解决方案**：
* **加互斥锁**：缓存雪崩可以看成多个缓存击穿，所以也可以使用互斥锁的解决方案。

* **错峰过期**：如果是大量缓存在同一时间过期的情况，我们还有一种解决方案就是在设置key过期时间的时候，
在加上一个短的随机过期时间，这样就能避免大量缓存在同一时间过期，引起的缓存雪崩。

* **集群**：尽量保证整个 redis 集群的高可用性，发现机器宕机尽快补上。选择合适的内存淘汰策略。
* **限流+本地缓存**：本地ehcache缓存 + hystrix限流&降级，避免MySQL崩掉。
* **恢复**：利用 redis 持久化机制保存的数据尽快恢复缓存。

























